{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","Negociacao","NegociacaoDao","ConnectionFactory","NegociacaoService","_http","Promise","all","obterNegociacoesDaSemana","obterNegociacoesDaSemanaAnterior","obterNegociacoesDaSemanaRetrasada","then","negociacoes","periodos","reduce","dados","periodo","concat","catch","Error","erro","resolve","reject","get","map","Date","objeto","data","quantidade","valor","console","log","err","negociacao","getConnection","conexao","dao","adiciona","listaTodos","apagaTodos","listaAtual","obterNegociacoes","filter","some","isEquals","negociacaoExistente","error"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import {HttpService} from './HttpService';\nimport {Negociacao} from '../models/Negociacao';\nimport {NegociacaoDao} from '../dao/NegociacaoDao';\nimport {ConnectionFactory} from '../services/ConnectionFactory';\n\nexport class NegociacaoService {\n\n\tconstructor() {\n\t\tthis._http = new HttpService();\n\t}\n\n\tobterNegociacoes() {\n\t\treturn Promise.all([\n\t\t\t\tthis.obterNegociacoesDaSemana(),\n\t\t\t\tthis.obterNegociacoesDaSemanaAnterior(),\n\t\t\t\tthis.obterNegociacoesDaSemanaRetrasada()\n\t\t])\n\t\t.then(periodos => {\n\t\t\tlet negociacoes = periodos\n\t\t\t.reduce((dados, periodo) => dados.concat(periodo), [])\n\t\t\treturn negociacoes;\n\t\t})\n\t\t.catch(erro => {\n\t\t\tthrow new Error(erro);\n\t\t});\n\t}\n\n\tobterNegociacoesDaSemana() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t\n\t\t\tthis._http\n\t\t\t.get('negociacoes/semana')\n\t\t\t.then(negociacoes => {\n\t\t\t\tresolve(negociacoes.map (objeto =>  new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor )));\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log(err);\n\t\t\t\treject(\"Não foi possivel obter as negociacoes da semana\");\n\t\t\t});\n\t\t});\n\t}\n\n\tobterNegociacoesDaSemanaAnterior() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t\n\t\t\tthis._http\n\t\t\t.get('negociacoes/anterior')\n\t\t\t.then(negociacoes => {\n\t\t\t\tresolve(negociacoes.map (objeto =>  new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor )));\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log(err);\n\t\t\t\treject(\"Não foi possivel obter as negociacoes da semana anterior\");\n\t\t\t});\n\t\t});\n\t}\n\n\tobterNegociacoesDaSemanaRetrasada() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t\n\t\t\tthis._http\n\t\t\t.get('negociacoes/retrasada')\n\t\t\t.then(negociacoes => {\n\t\t\t\tresolve(negociacoes.map (objeto =>  new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor )));\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log(err);\n\t\t\t\treject(\"Não foi possivel obter as negociacoes da semana retrasada\");\n\t\t\t});\n\t\t});\n\t}\n\n\tcadastra(negociacao){\n\n\t\treturn ConnectionFactory\n\t\t\t\t.getConnection()\n\t\t\t\t.then(conexao => new NegociacaoDao(conexao))\n\t\t\t\t.then(dao => dao.adiciona(negociacao))\n\t\t\t\t.then(() => \"Negociação adicionada com sucesso!\")\n\t\t\t\t.catch(erro => {\n\t\t\t\t\tconsole.log(erro);\n\t\t\t\t\tthrow new Error(\"Não foi possivel adicionar a negociação\");\n\t\t\t\t});\n\n\t}\n\n\tlista(){\n\n\t\treturn ConnectionFactory\n\t\t\t\t.getConnection()\n\t\t\t\t.then(conexao => new NegociacaoDao(conexao))\n\t\t\t\t.then(dao => dao.listaTodos())\n\t\t\t\t.catch(erro => {\n\t\t\t\t\tconsole.log(\"Erro\", erro);\n\t\t\t\t\tthrow new Error(\"Não foi possivel adicionar a negociação\");\n\t\t\t\t});\n\t\t\t\t\n\t}\n\n\n\tapaga() {\n\n\t\treturn ConnectionFactory\n\t\t\t\t.getConnection()\n\t\t\t\t.then(conexao => new NegociacaoDao(conexao))\n\t\t\t\t.then(dao => dao.apagaTodos())\n\t\t\t\t.then( () => \"Negociacao apagada com sucesso\")\n\t\t\t\t.catch(erro => {\n\t\t\t\t\tconsole.log(\"Erro\", erro);\n\t\t\t\t\tthrow new Error(\"Não foi possivel apagar a negociação\");\n\t\t\t\t});\n\t}\n\n\timporta(listaAtual) {\n\n\t\treturn this.obterNegociacoes()\n\t\t\t\t\t.then( negociacoes => \n\t\t\t\t\t\tnegociacoes.filter(negociacao => \n\t\t\t\t\t\t\t!listaAtual.some(negociacaoExistente =>\n\t\t\t\t\t\t\t\tnegociacao.isEquals(negociacaoExistente))))\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tconsole.log(error);\n\t\t\t\t\t\tthrow new Error(\"Não foi possivel importar as negociacoes\")\n\t\t\t\t\t});\n\t}\n\n}"]}